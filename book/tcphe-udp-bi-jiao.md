> 原文链接： [https://github.com/ljianshu/Blog/issues/61](https://github.com/ljianshu/Blog/issues/61)

## TCP/IP网络模型

1. 链路层：负责封装和解封装IP报文
2. 网络层：负责路由以及把分组报文发送给目标网络或主机 IP协议
3. 传输层：负责对报文进行分组和重组  TCP或UDP协议
4. 应用层：负责向用户提供应用程序 HTTP协议 FTP DNS

![](/assets/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031392f322f32342f313639316666373630636361313062333f773d3130333326683d34303026663d706e6726733d3236373139.png)

## UDP

用户数据报协议 不提供数据包分组、组装、不能对数据包进行排序

* **面向无连接** 不进行握手 直接发送数据 并且不会对数据报文进行任何拆分和拼接操作
* **有单博 多博 广播的功能 **支持一对一 多对一 多对多的方式
* **UDP面向报文 **不对数据报文进行任何操作 只是添加部 所以 应用程序必须选择合适大小的报文
* **不可靠性 **不会备份 不会验证是否完整和已确认接受 没有拥塞控制
* **头部开销小 只有八字节** 头部包含：1.两个十六位的端口号 分贝未源端口 和 目标端口 2.整个数据报文的长度 3.整个数据报文的检验和 

## TCP

传输控制协议是一种面向连接的、可靠的、基于字节流的传输层通信协议

#### 1 TCP连接过程

**第一次握手**

客户端向服务端发送连接请求报文段**SYN**。该报文段中包含自身的数据通讯初始序号。请求发送后，客户端便进入 SYN-SENT 状态。

**第二次握手**

服务端收到连接请求报文段后，如果同意连接，则会发送一个应答**ACK**，该应答中也会包含自身的数据通讯初始序号**SYN**，发送完成后便进入 SYN-RECEIVED 状态。

**第三次握手**

当客户端收到连接同意的应答后，还要向服务端发送一个确认报文**ACK**。客户端发完这个报文段后便进入 ESTABLISHED 状态，服务端收到这个应答后也进入 ESTABLISHED 状态，此时连接建立成功

#### 2 TCP断开链接

TCP是全双工的 在断开连接时两端都需要发送FIN和ACK

##### **第一次握手**

若客户端 A 认为数据发送完成，则它需要向服务端 B 发送连接释放请求。

##### **第二次握手**

B 收到连接释放请求后，会告诉应用层要释放 TCP 链接。然后会发送 ACK 包，并进入 CLOSE\_WAIT 状态，此时表明 A 到 B 的连接已经释放，不再接收 A 发的数据了。但是因为 TCP 连接是双向的，所以 B 仍旧可以发送数据给 A。

##### **第三次握手**

B 如果此时还有没发完的数据会继续发送，完毕后会向 A 发送连接释放请求，然后 B 便进入 LAST-ACK 状态。

##### **第四次握手**

A 收到释放请求后，向 B 发送确认应答，此时 A 进入 TIME-WAIT 状态。该状态会持续 2MSL（最大段生存期，指报文段在网络中生存的时间，超时会被抛弃） 时间，若该时间段内没有 B 的重发请求的话，就进入 CLOSED 状态。当 B 收到确认应答后，也便进入 CLOSED 状态。

#### 3 TCP 协议的特点

**面向连接**

面向连接，是指发送数据之前必须在两端建立连接。建立连接的方法是“三次握手”，这样能建立可靠的连接。建立连接，是为数据的可靠传输打下了基础。

**仅支持单播传输**

每条 TCP 传输连接只能有两个端点，只能进行点对点的数据传输，不支持多播和广播传输方式。

**面向字节流**

TCP 不像 UDP 一样那样一个个报文独立地传输，而是在**不保留报文边界**的情况下以字节流方式进行传输。

**可靠传输**

对于可靠传输，判断丢包，误码靠的是 TCP 的**段编号**以及**确认号**。TCP 为了保证报文传输的可靠，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的字节发回一个相应的**确认\(ACK\)**；如果发送端实体在合理的**往返时延**\(RTT\)内未收到确认，那么对应的数据（假设丢失了）将会被重传。

**提供拥塞控制**

当网络出现拥塞的时候，TCP 能够减小向网络注入数据的速率和数量，缓解拥塞

**TCP 提供全双工通信**

TCP 允许通信双方的应用程序在任何时候都能发送数据，因为 TCP 连接的两端都设有**缓存**，用来临时存放双向通信的数据。当然，TCP 可以立即发送一个数据段，也可以缓存一段时间以便一次发送更多的数据段（最大的数据段大小取决于 MSS）

## 4 TCP和UDP的比较

#### 1.对比

|  | UDP | TCP |
| :--- | :--- | :--- |
| 是否连接 | 无连接 | 面向连接 |
| 是否可靠 | 不可靠传输，不使用流量控制和拥塞控制 | 可靠传输，使用流量控制和拥塞控制 |
| 连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信 | 只能是一对一通信 |
| 传输方式 | 面向报文 | 面向字节流 |
| 首部开销 | 首部开销小，仅 8 字节 | 首部最小 20 字节，最大 60 字节 |
| 适用场景 | 适用于实时应用（IP 电话、视频会议、直播等） | 适用于要求可靠传输的应用，例如文件传输 |

#### 2 总结

* TCP 向上层提供面向连接的可靠服务 ，UDP 向上层提供无连接不可靠服务。
* 虽然 UDP 并没有 TCP 传输来的准确，但是也能在很多实时性要求高的地方有所
* 对数据准确性要求高，速度可以相对较慢的，可以选用 TCP











